name: "ğŸŒ™ Nightly"

on:
  schedule:
    - cron: "0 4 * * *"
  workflow_dispatch:

jobs:
  test-race:
    name: "ğŸ§ª Race Tests"
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“¥ Checkout"
        uses: actions/checkout@v4
      - name: "ğŸ§° Setup"
        uses: jdx/mise-action@v2
      - name: "ğŸ“¦ Install dependencies"
        run: pnpm install
      - name: "ğŸ§ª Race Tests"
        run: task test:race
      - name: "â¬†ï¸ Upload Test Logs"
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: nightly-race-logs
          path: |
            quarry/**/*.log
            sdk/**/*.log
            executor-node/**/*.log
          retention-days: 14

  test-e2e:
    name: "ğŸ”Œ E2E Tests"
    runs-on: ubuntu-latest
    steps:
      - name: "ğŸ“¥ Checkout"
        uses: actions/checkout@v4
      - name: "ğŸ§° Setup"
        uses: jdx/mise-action@v2
      - name: "ğŸ“¦ Install dependencies"
        run: pnpm install
      - name: "ğŸ”Œ E2E Tests"
        run: task test:e2e
        env:
          QUARRY_NO_SANDBOX: "1"
      - name: "â¬†ï¸ Upload E2E Logs"
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: nightly-e2e-logs
          path: |
            quarry/**/*.log
          retention-days: 14
